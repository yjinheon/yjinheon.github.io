---
title: "[Spring]threadlocal"
categories:
  - [backend, Spring]
tags:
  - Spring
date:
updated:
---

### 동시성 이슈

> #Spring #concept `동시성 이슈` : 여러 Thread가 동시에 여러 값을 변경하면서 발생하는 문제. 기본적으로 같은 인스턴스의 필드를 여러 쓰레드가 접근할 경우 발생

- 기본적으로 지역변수에서는 쓰레드마다 각각 다른 메모리 영역이 할당되기 때문에 동시성 이슈가 발생하지 않는다.
- 보통 여러 쓰레드가 싱글톤 인스턴스의 필드에 접근할 때 발생한다.
- static 과 같은 공용 필드에 접근할 때도 발생한다.
- 여러 쓰레드가 같은 인스턴스의 필드에 접근해야 하기 때문에 트래픽이 적은 상황에서는 잘 발생하지 않는다.
- 값을 읽기만 할 경우에는 발생하지 않고 어디선가 값을 변경할 때 발생한다.
- 스프링 빈은 기본적으로 싱글톤 객체의 필드를 변경해서 사용하기 때문에 동시성 이슈에 주의해야 한다.

### Thread Local

> `Thread Local` : 멀티쓰레딩에서 각각의 쓰레드가 전용 데이터 저장소를 가지는 것

#### 주의사항

웹 어플리케이션의 경우 보통 Thread Pool을 사용하기 때문에 이전에 사용되었고 값이 반환되지 않은 쓰레드가 할당된다면 다른 쓰레드의 리턴값 을 반환하게 될 수 있다. 따라서 사용 후 `Thread Local.remove`를 통해 반드시 제거해야 한다.

